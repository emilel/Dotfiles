# sudo snap install pdftk; pdftk in.pdf output out.pdf uncompress; LESSOPEN="" less out.pdf

# random
alias nonoti='notify-send DUNST_COMMAND_PAUSE'
alias noti='notify-send DUNST_COMMAND_RESUME'
alias k='echo "hoppsan..."'
alias dkill='docker container kill $(docker ps -q); docker container rm $(docker ps -a -q)'
alias areload='source ~/.zsh_aliases'


# why tho
# alias splitv='export SPLIT=v'
# alias splitb='export SPLIT=h'

# shortcuts
alias v='nvim'
alias up='cd ..'
alias upp='.cd ./..'
alias uppp='.cd ./../..'
alias bt='bluetoothctl'
alias cbt='echo "connect 94:DB:56:52:B5:87" | bluetoothctl'
alias dcbt='echo "disconnect 94:DB:56:52:B5:87" | bluetoothctl'
alias dog='bat --paging never --number'
alias py='python3'
alias lower="rename -v 'y/A-Z/a-z/'"
alias rmsym="rename -v 's/\(|\[|\]|\)//g'"
# alias xargs='tr \\n \\0 | xargs -0 '
alias _='cd ~'
alias bell="echo -e '\a'"
alias back='cd -'
alias icat="kitty +kitten icat"
alias c='clear'
alias view='nvim -R -u ~/.vimrc.view +AnsiEsc'
alias copy="perl -pe 'chomp if eof' | xclip -selection clipboard"
alias btc='btconnect'
alias btd='btdisconnect'
alias scs='screenshot'
alias setsi='set_sink'
alias setso='set_source'
alias getso='get_source'
alias getsi='get_sink'
alias gitb="git rev-parse --abbrev-ref HEAD | perl -pe 'chomp if eof'"
alias ssh='TERM=screen-256color ssh'
alias sources='pactl list | grep -A2 -B0 "Source #" | view'
alias sinks='pactl list | grep -A2 -B0 "Sink #" | view'


# custom program settings
alias ls='ls -v --group-directories-first --color=auto'
alias mv='mv -nv'
alias cp='cp -nv'
alias rm='rm -v'

# conf
alias conf='cd ~/dotfiles && nvim -c "Tfiles" && cd -'


# key shortcuts

# vim keys for tab suggestions
bindkey -M menuselect 'h' vi-backward-char
bindkey -M menuselect 'k' vi-up-line-or-history
bindkey -M menuselect 'l' vi-forward-char
bindkey -M menuselect 'j' vi-down-line-or-history


# edit command in editor
autoload edit-command-line;
zle -N edit-command-line
bindkey -M vicmd 'V' edit-command-line

# fzf
bindkey '^A' fzf-file-widget
bindkey '^S' fzf-cd-widget


# open fzf
zle -N n
bindkey '^U' n


# functions
open() {
    for word in $@
    do
        mimeo $word 2>/dev/null &disown
    done
}

viewpdf() {
    pdftoppm -jpeg $@ | icat --place 100x100@0x0
}


rmswe() {
    rename -v 's/å/a/g' $@
    rename -v 's/ä/a/g' $@
    rename -v 's/ö/o/g' $@
}

# mkdir and touch
touchp() {
    mkdir -p "$(dirname "$1")" && touch "$1"
}

rep() {
    action="$1"
    shift
    for file in $@
    do
        $action $file
    done
}

fzfopen() {
    for file in $(fzf -m --preview-window=down --preview "bat --color=always --line-range :50 {}")
    do
        xdg-open $file 2>/dev/null &disown
    done
}

pushnew() {
  git push --set-upstream origin $(git rev-parse --abbrev-ref HEAD)
}

pptxtopdf() {
    soffice --headless --convert-to pdf $1
}

cd() {
    builtin cd $1
    echo $(pwd) > ~/.last_dir
}

cdl() {
    cd $(cat ~/.last_dir)
}

n ()
{
    # Block nesting of nnn in subshells
    if [ -n $NNNLVL ] && [ "${NNNLVL:-0}" -ge 1 ]; then
        echo "nnn is already running"
        return
    fi

    # The default behaviour is to cd on quit (nnn checks if NNN_TMPFILE is set)
    # To cd on quit only on ^G, remove the "export" as in:
    #     NNN_TMPFILE="${XDG_CONFIG_HOME:-$HOME/.config}/nnn/.lastd"
    # NOTE: NNN_TMPFILE is fixed, should not be modified
    export NNN_TMPFILE="${XDG_CONFIG_HOME:-$HOME/.config}/nnn/.lastd"

    # Unmask ^Q (, ^V etc.) (if required, see `stty -a`) to Quit nnn
    # stty start undef
    # stty stop undef
    # stty lwrap undef
    # stty lnext undef

    nnn -R "$@"

    if [ -f "$NNN_TMPFILE" ]; then
            . "$NNN_TMPFILE"
            rm -f "$NNN_TMPFILE" > /dev/null
    fi
}

# view as prepend
viewp() {
    if [ -f "$1" ]
    then
        nvim -R -u ~/.vimrc.view $@
    else
        $@ | nvim -R -u ~/.vimrc.view +AnsiEsc
    fi
}

# copy as prepend
copyp() {
    $@ | perl -pe 'chomp if eof' | xclip -selection clipboard
}

# get path
path() {
    if [ $# -eq 2 ]
    then
        realpath --relative-to $2 $1
    else
        realpath --relative-to ~ $1
    fi
}


name() {
    realpath $@ | awk -F / '{ print $(NF) }'
}

screenshot() {
    scrot $@ -d2 -e 'xclip -selection clipboard -t image/png -i $f' \
        ~/screenshots/screenshot_%Y%m%d-%H%M.png
}

bati() {
    viu -w 83 $@ | bat
}

rmspace() {
    for file in $@
    do
        mv -v $file $(echo $file | tr ' ' _)
    done
}
